<div class="sidebar-sticky pt-3">
    <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
        <span>Menú Principal</span>
    </h6>

    <ul class="nav flex-column">
        <!-- Dashboard (todos) -->
        <li class="nav-item">
            <a class="nav-link {% if request.resolver_match.url_name == 'dashboard' %}active{% endif %}"
                href="{% url 'dashboard' %}">
                <i class="bi bi-speedometer2 me-2"></i>
                Dashboard
            </a>
        </li>

        {% if user.es_admin %}
        <!-- Menú Admin -->
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Administración</span>
        </h6>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'solicitudes:lista' %}">
                <i class="bi bi-clipboard-check me-2"></i>
                Solicitudes
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'solicitudes:crear' %}">
                <i class="bi bi-file-earmark-plus me-2"></i>
                Nueva Solicitud
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'bodega:gestion_pedidos' %}">
                <i class="bi bi-arrow-right-circle me-2"></i>
                Gestión de pedidos
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'ia_chat' %}">
                <i class="bi bi-robot me-2"></i>
                Asistente IA
            </a>
        </li>

        <!-- Inventario Admin -->
        <li class="nav-item">
            <a class="nav-link {% if 'inventario' in request.path %}active{% endif %}" href="#submenuInventario"
                data-bs-toggle="collapse">
                <i class="bi bi-boxes me-2"></i>
                Inventario SAP
            </a>
            <div class="collapse {% if 'inventario' in request.path %}show{% endif %}" id="submenuInventario">
                <ul class="nav flex-column ms-3">
                    <li class="nav-item">
                        <a class="nav-link py-1" href="{% url 'inventario:consultar_stock' %}">
                            <i class="bi bi-search me-2"></i> Consultar
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link py-1" href="{% url 'inventario:cargar_stock' %}">
                            <i class="bi bi-cloud-upload me-2"></i> Cargar Archivo
                        </a>
                    </li>
                </ul>
            </div>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'lista_bodegas' %}">
                <i class="bi bi-box-seam me-2"></i>
                Gestión Bodega
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'despacho:gestion' %}">
                <i class="bi bi-truck me-2"></i>
                Gestión Despacho
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="#">
                <i class="bi bi-receipt me-2"></i>
                Emisión de Guías
            </a>
        </li>

        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Configuración</span>
        </h6>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'lista_usuarios' %}">
                <i class="bi bi-people me-2"></i>
                Usuarios
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'configuracion:lista_transportes' %}">
                <i class="bi bi-truck-flatbed me-2"></i>
                Transportes
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'configuracion:lista_estados' %}">
                <i class="bi bi-layers me-2"></i>
                Estados
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="{% url 'configuracion:lista_tipos_solicitud' %}">
                <i class="bi bi-file-earmark-text me-2"></i>
                Tipos de Solicitud
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link {% if 'reportes' in request.path %}active{% endif %}" href="{% url 'reportes:informe_completo' %}">
                <i class="bi bi-bar-chart me-2"></i>
                Reportes y KPIs
            </a>
        </li>

        {% elif user.es_bodega %}
        <!-- Menú Bodega -->
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Bodega</span>
        </h6>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'solicitudes:lista' %}">
                <i class="bi bi-clipboard-check me-2"></i>
                Solicitudes Pendientes
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link {% if 'inventario' in request.path %}active{% endif %}"
                href="{% url 'inventario:consultar_stock' %}">
                <i class="bi bi-boxes me-2"></i>
                Consultar Stock
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link {% if 'bodega/pedidos' in request.path %}active{% endif %}"
                href="{% url 'bodega:gestion_pedidos' %}">
                <i class="bi bi-arrow-right-circle me-2"></i>
                Gestión de pedidos
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="#">
                <i class="bi bi-list-check me-2"></i>
                Mis Transferencias
            </a>
        </li>

        {% elif user.es_despacho %}
        <!-- Menú Despacho -->
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
            <span>Despacho</span>
        </h6>

        <li class="nav-item">
            <a class="nav-link {% if 'despacho/gestion' in request.path %}active{% endif %}" href="{% url 'despacho:gestion' %}">
                <i class="bi bi-box-seam me-2"></i>
                Gestión Despacho
            </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="{% url 'despacho:gestion' %}?tab=bultos">
                <i class="bi bi-truck me-2"></i>
                Bultos en ruta
            </a>
        </li>
        {% endif %}
    </ul>
</div>

<style>
    .sidebar {
        position: fixed;
        top: 56px;
        bottom: 0;
        left: 0;
        z-index: 100;
        padding: 0;
        box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
    }

    .sidebar-sticky {
        height: calc(100vh - 56px);
        overflow-x: hidden;
        overflow-y: auto;
    }

    .sidebar .nav-link {
        font-weight: 500;
        color: #333;
        padding: 0.75rem 1rem;
        transition: all 0.2s;
    }

    .sidebar .nav-link:hover {
        color: var(--pesco-primary);
        background-color: rgba(0, 180, 216, 0.1);
    }

    .sidebar .nav-link.active {
        color: var(--pesco-primary);
        background-color: rgba(0, 180, 216, 0.15);
        border-left: 3px solid var(--pesco-primary);
    }

    .sidebar-heading {
        font-size: .75rem;
        text-transform: uppercase;
    }
</style>